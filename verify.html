<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verify Account - Student Best Income</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f9ff; padding: 20px; }
header { background: #3b82f6; color: white; padding: 15px; text-align:center; font-size:1.3em; }
.container { background: #e0f2fe; padding: 20px; border-radius: 10px; max-width: 500px; margin: 20px auto; }
input, select { width: 90%; padding: 10px; margin: 10px 0; font-size:1em; }
button { padding: 10px 20px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
button:hover { opacity:0.9; }
.copyBtn { background:#3b82f6; color:white; margin-left:10px; }
#verifyBtn { background:#10b981; color:white; }
.success { color:green; font-weight:bold; margin-top:10px; }
.error { color:red; font-weight:bold; margin-top:10px; }
.pending { color:orange; font-weight:bold; margin-top:10px; }
</style>
</head>
<body>

<header>üåü Verify Account üåü</header>

<div class="container" id="verifyContainer">
    <p id="message">Loading...</p>

    <div id="payForm" style="display:none;">
        <h3>Pay Cash Form</h3>
        <p>‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶á ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶è‡¶°‡¶º‡¶æ‡¶§‡ßá ‡¶∏‡¶†‡¶ø‡¶ï TxnID ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        <p>‡¶è‡¶á ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶Ö‡¶∞‡ßç‡¶• ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡¶§‡ßá Send Money ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>

        <p>
            Personal: <span id="personalNumber">01338553254</span>
            <button class="copyBtn" onclick="copyNumber()">Copy</button>
        </p>

        <p>
            Method:
            <select id="payMethod">
                <option value="bkash">Bkash</option>
                <option value="nagad">Nagad</option>
            </select>
        </p>

        <p>Pay: 20 Tk</p>

        <input type="text" id="userNumber" placeholder="Your number (sender)">
        <input type="text" id="txnId" placeholder="Transaction ID">
        <button id="verifyBtn">VERIFY</button>

        <p class="success" id="successMsg"></p>
        <p class="error" id="errorMsg"></p>
        <p class="pending" id="pendingMsg"></p>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyBEbzvJ5asGNPp85_Uyvk1N_TCjIBfECXY",
    authDomain: "studentbestincome.firebaseapp.com",
    databaseURL: "https://studentbestincome-default-rtdb.firebaseio.com",
    projectId: "studentbestincome",
    storageBucket: "studentbestincome.firebasestorage.app",
    messagingSenderId: "261636758539",
    appId: "1:261636758539:web:faea7afabe319a53117b0e",
    measurementId: "G-6L77EJ7MJF"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// DOM elements
const message = document.getElementById('message');
const payForm = document.getElementById('payForm');
const verifyBtn = document.getElementById('verifyBtn');
const successMsg = document.getElementById('successMsg');
const errorMsg = document.getElementById('errorMsg');
const pendingMsg = document.getElementById('pendingMsg');

// Copy personal number
function copyNumber(){
    const personal = document.getElementById('personalNumber').innerText;
    navigator.clipboard.writeText(personal).then(()=>{
        alert('Copied: ' + personal);
    });
}

// Check auth state
auth.onAuthStateChanged(user=>{
    if(user){
        db.ref('users/' + user.uid).once('value').then(snapshot=>{
            const data = snapshot.val();
            if(data && data.isVerified){
                message.innerText = '‚úÖ Your account is already verified!';
            } else if(data && data.payment && Object.values(data.payment).some(p=>p.status==='pending')) {
                payForm.style.display = 'block';
                pendingMsg.innerText = '‚è≥ Payment pending verification';
                verifyBtn.disabled = true;
            } else {
                message.innerText = '';
                payForm.style.display = 'block';
            }
        });
    } else {
        message.innerText = '‚ö†Ô∏è Please login first to verify your account';
    }
});

// Handle VERIFY click
verifyBtn.addEventListener('click', ()=>{
    errorMsg.innerText = '';
    successMsg.innerText = '';
    pendingMsg.innerText = '';

    const userNumber = document.getElementById('userNumber').value.trim();
    const txnId = document.getElementById('txnId').value.trim();
    const payMethod = document.getElementById('payMethod').value;

    if(!userNumber || !txnId){
        errorMsg.innerText = '‚ùå Please fill all fields';
        return;
    }

    const user = auth.currentUser;
    if(user){
        const paymentData = {
            uid: user.uid,
            email: user.email,
            displayName: user.displayName || 'No Name',
            amount: 20,
            userNumber: userNumber,
            txnId: txnId,
            method: payMethod,
            status: 'pending',
            timestamp: Date.now()
        };

        // Save to user's payment history
        db.ref('users/' + user.uid + '/payment/' + txnId).set(paymentData)
        .then(()=>{
            // Save to admin verifyRequests
            db.ref('verifyRequests/' + txnId).set(paymentData)
            .then(()=>{
                successMsg.innerText = '‚úÖ Payment submitted for verification';
                pendingMsg.innerText = '‚è≥ Pending verification';
                verifyBtn.disabled = true;
            })
            .catch(err=>{ console.error('Admin update failed:', err); });
        })
        .catch(err=>{
            errorMsg.innerText = '‚ùå Error: ' + err.message;
        });
    }
});
</script>

</body>
</html>
