<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offers - Student Best Income</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f0f2f5; }
  h1 { text-align: center; color: #333; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { padding: 12px; text-align: center; border-bottom: 1px solid #ccc; }
  button { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; }
  .locked { background-color: #ccc; color: #666; cursor: not-allowed; }
  .active { background-color: #4CAF50; color: #fff; }
</style>
</head>
<body>

<h1>ðŸ’Ž Referral & Bonus Offers ðŸ’Ž</h1>

<table>
  <thead>
    <tr>
      <th>Refers</th>
      <th>Direct Refers</th>
      <th>Bonus (Tk)</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="offerTable">
    <!-- JS will populate rows here -->
  </tbody>
</table>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBEbzvJ5asGNPp85_Uyvk1N_TCjIBfECXY",
    authDomain: "studentbestincome.firebaseapp.com",
    projectId: "studentbestincome",
    storageBucket: "studentbestincome.firebasestorage.app",
    messagingSenderId: "261636758539",
    appId: "1:261636758539:web:faea7afabe319a53117b0e",
    measurementId: "G-6L77EJ7MJF"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Example user ID (replace with auth user id)
  const userId = "USER123";

  // Offer data
  const offers = [
    {ref: 20, direct: 10, bonus: 300},
    {ref: 50, direct: 25, bonus: 600},
    {ref: 100, direct: 50, bonus: 1200},
    {ref: 200, direct: 100, bonus: 2400},
    {ref: 500, direct: 250, bonus: 5000},
    {ref: 1000, direct: 500, bonus: 9000},
  ];

  const offerTable = document.getElementById("offerTable");

  // Load claimed status from Firebase
  db.collection("users").doc(userId).get().then(doc => {
    const claimedData = doc.exists ? doc.data().claimed || {} : {};

    offers.forEach((offer, index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${offer.ref}</td>
        <td>${offer.direct}</td>
        <td>${offer.bonus} Tk</td>
        <td>
          <button id="claimBtn${index}" class="${claimedData[index] ? 'locked' : 'active'}" ${claimedData[index] ? 'disabled' : ''}>
            ${claimedData[index] ? 'Claimed' : 'Claim'}
          </button>
        </td>
      `;
      offerTable.appendChild(tr);

      if(!claimedData[index]) {
        document.getElementById(`claimBtn${index}`).addEventListener("click", () => {
          // Update user's bonus in Firestore
          db.collection("users").doc(userId).set({
            claimed: {...claimedData, [index]: true},
            balance: firebase.firestore.FieldValue.increment(offer.bonus)
          }, {merge:true}).then(() => {
            document.getElementById(`claimBtn${index}`).innerText = "Claimed";
            document.getElementById(`claimBtn${index}`).classList.add("locked");
            document.getElementById(`claimBtn${index}`).disabled = true;
            alert(`ðŸŽ‰ You received ${offer.bonus} Tk bonus!`);
          });
        });
      }
    });
  });
</script>

</body>
</html>
