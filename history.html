
<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>History - Student Best Income</title>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>

<style>
  body { font-family: Arial; background:#f3f4f6; padding:20px; }
  h1 { color:#3b82f6; text-align:center; margin-bottom:20px; }
  .section { background:white; padding:15px; margin:15px 0; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  .task, .withdraw { margin:8px 0; padding:5px; border-bottom:1px solid #ddd; }
</style>
</head>
<body>

<h1>📊 Daily Task & Withdraw History 📊</h1>

<div class="section">
  <h2>Daily Task History</h2>
  <div id="taskHistory">Loading...</div>
</div>

<div class="section">
  <h2>💰 Withdraw History</h2>
  <div id="withdrawHistory">Loading...</div>
</div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyBEbzvJ5asGNPp85_Uyvk1N_TCjIBfECXY",
    authDomain: "studentbestincome.firebaseapp.com",
    projectId: "studentbestincome",
    storageBucket: "studentbestincome.firebasestorage.app",
    messagingSenderId: "261636758539",
    appId: "1:261636758539:web:faea7afabe319a53117b0e",
    measurementId: "G-6L77EJ7MJF"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged(user => {
    if(!user) {
      window.location.href = "login.html";
      return;
    }
    const uid = user.uid;

    // Load Task History
    db.collection('task_history')
      .where('userId','==',uid)
      .orderBy('timestamp','desc')
      .onSnapshot(snapshot=>{
        const taskDiv = document.getElementById('taskHistory');
        taskDiv.innerHTML = '';
        snapshot.forEach(doc=>{
          const data = doc.data();
          taskDiv.innerHTML += `<div class="task">1️⃣ ${data.taskName}: ${data.tk} TK | ${data.date} | ${data.status}</div>`;
        });
      });

    // Load Withdraw History
    db.collection('withdraws')
      .where('userId','==',uid)
      .orderBy('timestamp','desc')
      .onSnapshot(snapshot=>{
        const withdrawDiv = document.getElementById('withdrawHistory');
        withdrawDiv.innerHTML = '';
        snapshot.forEach(doc=>{
          const data = doc.data();
          withdrawDiv.innerHTML += `<div class="withdraw">🔹 Withdraw: ${data.method || '-'} | ${data.number || '-'} | ${data.amount} TK | ${data.status}</div>`;
        });
      });
  });

</script>

</body>
</html>
