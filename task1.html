<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task 1 - Student Best Income</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f9ff; text-align:center; padding:20px; }
h1 { color: #3b82f6; }
input, button { padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc; font-size:16px; width:90%; max-width:300px; }
button { background:#10b981; color:white; border:none; cursor:pointer; transition:0.3s; }
button:hover { background:#059669; }
.success { color:green; font-weight:bold; }
.error { color:red; font-weight:bold; }
</style>
</head>
<body>

<h1>‚û°Ô∏è Task 1</h1>
<p>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞/‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶® üëá</p>

<p>Before Task Screenshot:</p>
<input type="file" id="beforeScreenshot" accept="image/*"><br>

<p>After Task Screenshot:</p>
<input type="file" id="afterScreenshot" accept="image/*"><br>

<input type="text" id="contactInfo" placeholder="Your number or email"><br>

<button id="submitTask">SUBMIT</button>
<p class="success" id="successMsg"></p>
<p class="error" id="errorMsg"></p>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {  
    apiKey: "AIzaSyBEbzvJ5asGNPp85_Uyvk1N_TCjIBfECXY",  
    authDomain: "studentbestincome.firebaseapp.com",  
    databaseURL: "https://studentbestincome-default-rtdb.firebaseio.com",  
    projectId: "studentbestincome",  
    storageBucket: "studentbestincome.firebasestorage.app",  
    messagingSenderId: "261636758539",  
    appId: "1:261636758539:web:faea7afabe319a53117b0e",  
    measurementId: "G-6L77EJ7MJF"  
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

const submitBtn = document.getElementById('submitTask');
const successMsg = document.getElementById('successMsg');
const errorMsg = document.getElementById('errorMsg');

auth.onAuthStateChanged(user=>{
    if(!user){
        errorMsg.innerText = "‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!";
        submitBtn.disabled = true;
        return;
    }

    // Check if already submitted
    db.ref('users/' + user.uid + '/tasks/task1').once('value').then(snap=>{
        const status = snap.val();
        if(status === 'pending' || status === 'approved'){
            submitBtn.disabled = true;
            successMsg.innerText = "‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶á ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§ Status: " + status;
        }
    });
});

submitBtn.addEventListener('click', async ()=>{
    successMsg.innerText = '';
    errorMsg.innerText = '';

    const beforeFile = document.getElementById('beforeScreenshot').files[0];
    const afterFile = document.getElementById('afterScreenshot').files[0];
    const contact = document.getElementById('contactInfo').value.trim();

    const user = auth.currentUser;
    if(!user){
        errorMsg.innerText = "‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!";
        return;
    }

    if(!beforeFile || !afterFile || !contact){
        errorMsg.innerText = "‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!";
        return;
    }

    try {
        // Upload screenshots
        const beforeRef = storage.ref('tasks/' + user.uid + '/task1_before_' + Date.now());
        const afterRef = storage.ref('tasks/' + user.uid + '/task1_after_' + Date.now());

        const beforeSnap = await beforeRef.put(beforeFile);
        const afterSnap = await afterRef.put(afterFile);

        const beforeURL = await beforeSnap.ref.getDownloadURL();
        const afterURL = await afterSnap.ref.getDownloadURL();

        // Save submission
        const submissionKey = db.ref('taskSubmissions').push().key;
        await db.ref('taskSubmissions/' + submissionKey).set({
            uid: user.uid,
            taskId: 'task1',
            beforeScreenshot: beforeURL,
            afterScreenshot: afterURL,
            contact: contact,
            status: 'pending',
            reward: 5,
            submittedAt: Date.now()
        });

        // Update user task status
        await db.ref('users/' + user.uid + '/tasks/task1').set('pending');

        successMsg.innerText = "‚úÖ Task submitted! Waiting for admin approval.";
        submitBtn.disabled = true;

    } catch(err){
        errorMsg.innerText = "‚ùå Error: " + err.message;
    }
});
</script>

</body>
</html>
